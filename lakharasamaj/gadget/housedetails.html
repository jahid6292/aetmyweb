<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Animated Table with Export</title>

<!-- Libraries for Export -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:sans-serif;}
html,body{height:100%;width:100%;}
body{display:flex;justify-content:center;align-items:center;background:transparent;}
main.table{width:100%;height:100%;background:#fff5;backdrop-filter:blur(7px);border-radius:.8rem;overflow:hidden;display:flex;flex-direction:column;}
.table__header{width:100%;padding:.5rem 1rem;display:flex;justify-content:space-between;align-items:center;background:#fff4;border-radius:.5rem;}
.table__header h1{font-size:1rem;}
.table__header .input-group{width:30%;background:#fff5;border-radius:2rem;display:flex;align-items:center;padding:0 .8rem;transition:.2s;}
.table__header .input-group:hover{width:40%;background:#fff8;}
.table__header .input-group img{width:1.2rem;height:1.2rem;}
.table__header .input-group input{width:100%;border:none;outline:none;background:transparent;padding:0 .3rem;}
.table__body{flex:1;margin:.5rem 0;overflow:auto;background:#fffb;border-radius:.6rem;}
table{width:100%;border-collapse:collapse;}
th,td{padding:.8rem;text-align:left;}
td img{width:36px;height:36px;margin-right:.5rem;border-radius:50%;vertical-align:middle;}
thead th{position:sticky;top:0;background:#a5d098fe;cursor:pointer;}
tbody tr:nth-child(even){background-color:#0000000b;}
tbody tr:hover{background-color:#fff6 !important;}

/* Animation */
tbody tr{--delay:.1s;transition:.5s ease-in-out var(--delay),background-color 0s;}
tbody tr.hide{opacity:0;transform:translateX(100%);}
tbody tr td,tbody tr td p,tbody tr td img{transition:.2s ease-in-out;}
tbody tr.hide td,tbody tr.hide td p{padding:0;font:0/0 sans-serif;transition:.2s ease-in-out .5s;}
tbody tr.hide td img{width:0;height:0;transition:.2s ease-in-out .5s;}

.status{padding:.4rem 0;border-radius:2rem;text-align:center;}
.status.delivered{background-color:#86e49d;color:#006b21;}
.status.cancelled{background-color:#d893a3;color:#b30021;}
.status.pending{background-color:#ebc474;}
.status.shipped{background-color:#6fcaea;}

/* Export */
.export__file{position:relative;}
.export__file-btn{display:inline-block;width:2rem;height:2rem;background:#fff6;border-radius:50%;cursor:pointer;}
.export__file-options{position:absolute;right:0;top:2.2rem;width:12rem;background:#f2f2f2;border-radius:.5rem;text-align:center;opacity:0;transform:scale(.8);transform-origin:top right;transition:.2s;}
.export__file input:checked + .export__file-options{opacity:1;transform:scale(1);z-index:100;}
.export__file-options label{display:flex;justify-content:space-around;align-items:center;padding:.6rem 0;transition:.2s;cursor:pointer;}
.export__file-options label:first-of-type{font-weight:bold;}
.export__file-options img{width:2rem;height:auto;}
.export__file .export__file-btn {display: inline-block; width: 2rem; height: 2rem;background: #fff6 url(https://jahid6292.github.io/aetmyweb/lakharasamaj/images/export.png) center / 80% no-repeat;    border-radius: 50%;    transition: .2s ease-in-out;}
.export__file #export-file {display: none;}
</style>
</head>
<body>
<main class="table">
<section class="table__header">
<h1>House Details</h1>
<div class="input-group">
<input type="search" placeholder="Search Data...">
<img src="https://jahid6292.github.io/aetmyweb/lakharasamaj/images/search.png" alt="">
</div>
<div class="export__file">
<label for="export-file" class="export__file-btn" title="Export File"></label>
<input type="checkbox" id="export-file">
<div class="export__file-options">
<label>Export As ‚Üí</label>
<label for="export-file" id="toPDF">PDF <img src="https://jahid6292.github.io/aetmyweb/lakharasamaj/images/pdf.png"></label>
<label for="export-file" id="toJSON">JSON <img src="https://jahid6292.github.io/aetmyweb/lakharasamaj/images/json.png"></label>
<label for="export-file" id="toCSV">CSV <img src="https://jahid6292.github.io/aetmyweb/lakharasamaj/images/csv.png"></label>
<label for="export-file" id="toEXCEL">EXCEL <img src="https://jahid6292.github.io/aetmyweb/lakharasamaj/images/excel.png"></label>
</div>
</div>
</section>
<section class="table__body">
<table>
<thead>
<tr>
<th>S.no.</th>
<th>‡§®‡§æ‡§Æ</th>
<th>‡§™‡§ø‡§§‡§æ ‡§ï‡§æ ‡§®‡§æ‡§Æ</th>
<th>‡§Æ‡§ï‡§æ‡§® ‡§∏‡§Ç‡§ñ‡•ç‚Äç‡§Ø‡§æ</th>
</tr>
</thead>
<tbody>
<!-- Data from Google Sheet will load here -->
</tbody>
</table>
</section>
</main>

<script>
// üü¢ Google Apps Script JSON Endpoint
const apiURL = "https://script.google.com/macros/s/AKfycbwViN7jRK-7AUYk9ETYqfagQbN6mqbnBUixWKYN4X97Pg4piPzXEPwV7jd4aQ8E5-Ch/exec";

const tbody = document.querySelector('tbody');

// üü¢ Fetch Data from Google Sheet
async function loadData() {
  try {
    const res = await fetch(apiURL);
    const data = await res.json(); // Array of objects
    console.log("‚úÖ Sheet Data Loaded:", data);

    tbody.innerHTML = '';

    data.forEach((row, i) => {
      const tr = document.createElement('tr');
      tr.style.setProperty('--delay', i / 25 + 's');
      tr.innerHTML = `
        <td>${row["S.no."] || ""}</td>
        <td>${row["‡§®‡§æ‡§Æ"] || ""}</td>
        <td>${row["‡§™‡§ø‡§§‡§æ ‡§ï‡§æ ‡§®‡§æ‡§Æ"] || ""}</td>
        <td>${row["‡§Æ‡§ï‡§æ‡§® ‡§∏‡§Ç‡§ñ‡•ç‚Äç‡§Ø‡§æ"] || ""}</td>
      `;
      tbody.appendChild(tr);
    });
  } catch (err) {
    console.error("‚ö†Ô∏è Error loading data:", err);
    tbody.innerHTML = `<tr><td colspan="4" style="color:red;">Error loading data</td></tr>`;
  }
}

// Load on start
loadData();


// üîç SEARCH Filter
const search = document.querySelector('.input-group input');
search.addEventListener('input', () => {
  const val = search.value.toLowerCase();
  const rows = document.querySelectorAll('tbody tr');
  rows.forEach((row, i) => {
    const text = row.textContent.toLowerCase();
    row.classList.toggle('hide', !text.includes(val));
    row.style.setProperty('--delay', i / 25 + 's');
  });
});


// üîº SORT
document.querySelectorAll('thead th').forEach((th, i) => {
  let asc = true;
  th.addEventListener('click', () => {
    const rows = [...tbody.querySelectorAll('tr')];
    rows.sort((a, b) => {
      const aText = a.querySelectorAll('td')[i].textContent.toLowerCase();
      const bText = b.querySelectorAll('td')[i].textContent.toLowerCase();
      return asc ? aText.localeCompare(bText) : bText.localeCompare(aText);
    });
    rows.forEach(r => tbody.appendChild(r));
    asc = !asc;
  });
});


// üìÑ PDF Export
document.querySelector('#toPDF').onclick = async () => {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF('p', 'pt', 'a4');
  const table = document.querySelector('main.table');
  const canvas = await html2canvas(table, { scale: 2 });
  const imgData = canvas.toDataURL('image/png');
  const imgProps = doc.getImageProperties(imgData);
  const pdfWidth = doc.internal.pageSize.getWidth();
  const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;
  doc.addImage(imgData, 'PNG', 0, 0, pdfWidth, pdfHeight);
  doc.save("HouseDetails.pdf");
};


// üìÇ JSON Export
document.querySelector('#toJSON').onclick = () => {
  const heads = [...document.querySelectorAll('thead th')].map(th => th.textContent.trim());
  const data = [...document.querySelectorAll('tbody tr')].map(tr => {
    const obj = {};
    tr.querySelectorAll('td').forEach((td, i) => obj[heads[i]] = td.textContent.trim());
    return obj;
  });
  const a = document.createElement('a');
  a.href = 'data:application/json;charset=utf-8,' + encodeURIComponent(JSON.stringify(data, null, 2));
  a.download = 'HouseDetails.json';
  document.body.appendChild(a); a.click(); a.remove();
};


// üìä CSV Export
document.querySelector('#toCSV').onclick = () => {
  const heads = [...document.querySelectorAll('thead th')].map(th => th.textContent.trim()).join(',');
  const rows = [...document.querySelectorAll('tbody tr')].map(tr => {
    return [...tr.querySelectorAll('td')].map(td => td.textContent.trim().replace(/,/g, '.')).join(',');
  }).join('\n');
  const a = document.createElement('a');
  a.href = 'data:text/csv;charset=utf-8,' + encodeURIComponent(heads + '\n' + rows);
  a.download = 'HouseDetails.csv';
  document.body.appendChild(a); a.click(); a.remove();
};


// üìà Excel Export
document.querySelector('#toEXCEL').onclick = () => {
  const ws_data = [];
  const headers = [...document.querySelectorAll('thead th')].map(th => th.textContent.trim());
  ws_data.push(headers);
  document.querySelectorAll('tbody tr').forEach(tr => {
    ws_data.push([...tr.querySelectorAll('td')].map(td => td.textContent.trim()));
  });
  const ws = XLSX.utils.aoa_to_sheet(ws_data);
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, "HouseDetails");
  XLSX.writeFile(wb, "HouseDetails.xlsx");
};
</script>
</body>
</html>
